---
// ClientLogos - Sección para mostrar empresas que confían en nosotros con carrusel continuo
import { Image } from 'astro:assets';
import alcaldiaRioNegro from '../../assets/index/clientes/alcaldia-rio-negro copia.webp';
import donMatias from '../../assets/index/clientes/don-matias.webp';
import fundacionPascual from '../../assets/index/clientes/fundacion-pascual copia.webp';
import cliente1 from '../../assets/index/clientes/Recurso 1 copia.webp';
import universidadAntioquia from '../../assets/index/clientes/UNIVERSIDAD DE ANTIOQUIA copia.webp';

const logos = [
  { src: alcaldiaRioNegro, alt: 'Alcaldía Rio Negro' },
  { src: donMatias, alt: 'Don Matías' },
  { src: fundacionPascual, alt: 'Fundación Pascual' },
  { src: cliente1, alt: 'Cliente' },
  { src: universidadAntioquia, alt: 'Universidad de Antioquia' },
];
---

<section class="bg-light py-16">
  <div class="container mx-auto px-4">
    <!-- Título pequeño -->
    <h3 class="mb-12 text-center text-sm font-semibold tracking-wide text-gray-700 uppercase">
      Empresas que confían en nosotros
    </h3>

    <!-- Carrusel continuo -->
    <div class="relative overflow-hidden rounded-2xl">
      <!-- Contenedor del carrusel con efecto de máscara -->
      <div class="carousel-container relative h-40 md:h-56" id="carousel-container">
        <div class="carousel-track flex gap-4 md:gap-8" id="carousel-track">
          {logos.map((logo) => (
            <div class="carousel-item flex min-w-[280px] md:min-w-[400px] shrink-0 items-center justify-center">
              <div class="flex h-32 w-64 md:h-40 md:w-80 items-center justify-center rounded-xl bg-white p-2 shadow-md transition-all duration-300 hover:shadow-lg hover:scale-105">
                <Image
                  src={logo.src}
                  alt={logo.alt}
                  class="h-20 md:h-24 w-auto object-contain opacity-70 hover:opacity-100 transition-opacity duration-300"
                  width={400}
                />
              </div>
            </div>
          ))}
          {/* Duplicar los logos para efecto continuo */}
          {logos.map((logo) => (
            <div class="carousel-item flex min-w-[280px] md:min-w-[400px] shrink-0 items-center justify-center">
              <div class="flex h-32 w-64 md:h-40 md:w-80 items-center justify-center rounded-xl bg-white p-2 shadow-md transition-all duration-300 hover:shadow-lg hover:scale-105">
                <Image
                  src={logo.src}
                  alt={logo.alt}
                  class="h-20 md:h-24 w-auto object-contain opacity-70 hover:opacity-100 transition-opacity duration-300"
                  width={400}
                />
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Gradientes de desvanecimiento en los lados -->
      <div class="pointer-events-none absolute inset-y-0 left-0 w-20 bg-linear-to-r from-light to-transparent"></div>
      <div class="pointer-events-none absolute inset-y-0 right-0 w-20 bg-linear-to-l from-light to-transparent"></div>
    </div>
  </div>
</section>

<script>
  (() => {
    const track = document.getElementById('carousel-track');
    const container = document.getElementById('carousel-container');
    
    if (!track || !container) return;
    
    let currentPosition = 0;
    let isPaused = false;
    
    // Calcular el ancho del primer set de logos (5 logos)
    const getFirstSetWidth = (): number => {
      const items = track.querySelectorAll('.carousel-item');
      let width = 0;
      const gap = window.innerWidth < 768 ? 16 : 32; // gap-4 = 16px, gap-8 = 32px
      
      // Sumar el ancho de los primeros 5 items + gaps
      for (let i = 0; i < 5; i++) {
        const item = items[i] as HTMLElement;
        if (item) {
          width += item.offsetWidth;
          if (i < 4) width += gap;
        }
      }
      
      return width;
    };

    // Función de animación
    const animate = () => {
      if (isPaused) {
        requestAnimationFrame(animate);
        return;
      }
      
      const firstSetWidth = getFirstSetWidth();
      const speed = window.innerWidth < 768 ? 1.0 : 0.8; // Velocidad en px por frame (móvil un poco más rápido, escritorio más lento)
      
      currentPosition -= speed;
      
      if (currentPosition <= -firstSetWidth) {
        currentPosition = 0;
      }
      
      track.style.transform = `translateX(${currentPosition}px)`;
      requestAnimationFrame(animate);
    };

    // Pausar en hover
    container.addEventListener('mouseenter', () => {
      isPaused = true;
    });
    
    container.addEventListener('mouseleave', () => {
      isPaused = false;
    });

    // Iniciar animación
    requestAnimationFrame(animate);

    // Recalcular en resize
    let resizeTimeout: number | undefined;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = window.setTimeout(() => {
        currentPosition = 0;
      }, 250);
    });
  })();
</script>

<style>
  .carousel-container {
    overflow: hidden;
    mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
    -webkit-mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
  }
</style>
